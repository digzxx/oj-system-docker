# ----------------------------------------------------
# Nginx Master & Worker 配置
# ----------------------------------------------------
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile on;
    keepalive_timeout 65;

    # ----------------------------------------------------
    # 主服务器配置 (监听 80 端口，对外服务)
    # ----------------------------------------------------
    server {
        listen 80;
        server_name localhost; 

        # 1. API 请求代理：所有 /api/ 开头的请求转发给 Django 后端
        location /api/ {
            # 转发到 Docker Compose 中定义的 backend 服务，端口 8000
            proxy_pass http://backend:8000; 
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # 2. 根路径代理：所有其他请求（前端路由）转发给 React 前端开发服务器
        location / {
            # 转发到 Docker Compose 中定义的 frontend 服务，端口 5173 (Vite/React 默认)
            proxy_pass http://frontend:5173; 
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    }
}